# Workers Git é›†æˆè‡ªåŠ¨æ„å»ºä¿®å¤

## ğŸ” é—®é¢˜è¯Šæ–­

æ ¹æ® Cloudflare Dashboard æˆªå›¾ï¼ŒWorkers çš„ Git é›†æˆé…ç½®å¦‚ä¸‹ï¼š
- âœ… **Repository**: `keithhegit/public_opinion`
- âœ… **åˆ†æ”¯è·Ÿè¸ª**: `main`
- âš ï¸ **æ ¹ç›®å½•**: `/` ï¼ˆ**è¿™æ˜¯é—®é¢˜æ‰€åœ¨ï¼**ï¼‰
- âš ï¸ **æ„å»ºå‘½ä»¤**: `æ— `
- âœ… **éƒ¨ç½²å‘½ä»¤**: `npx wrangler deploy`

## ğŸš¨ é—®é¢˜åŸå› 

**æ ¹ç›®å½•è®¾ç½®ä¸º `/`**ï¼Œä½† Workers ä»£ç å®é™…åœ¨ `bettafish-workers/` ç›®å½•ä¸‹ã€‚è¿™å¯¼è‡´ï¼š
1. Cloudflare åœ¨ä»“åº“æ ¹ç›®å½•æŸ¥æ‰¾ `wrangler.toml` å’Œä»£ç 
2. æ‰¾ä¸åˆ°æ­£ç¡®çš„æ–‡ä»¶ï¼Œå¯¼è‡´æ„å»ºå¤±è´¥æˆ–ä¸è§¦å‘

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### Step 1: ä¿®æ”¹æ ¹ç›®å½•è®¾ç½®

1. **åœ¨ Cloudflare Dashboard ä¸­**:
   - è¿›å…¥ **Workers & Pages** â†’ **bettafish-api-prod**
   - ç‚¹å‡» **Settings** â†’ **æ„å»º** (Build)
   - æ‰¾åˆ° **æ„å»ºé…ç½®** (Build Configuration)
   - ç‚¹å‡» **æ ¹ç›®å½•** æ—è¾¹çš„ç¼–è¾‘å›¾æ ‡ âœï¸
   - ä¿®æ”¹ä¸ºï¼š`bettafish-workers`
   - ç‚¹å‡» **Save**

### Step 2: æ£€æŸ¥æ„å»ºå‘½ä»¤ï¼ˆå¯é€‰ï¼‰

å¦‚æœ Workers éœ€è¦æ„å»ºæ­¥éª¤ï¼ˆä¾‹å¦‚ TypeScript ç¼–è¯‘ï¼‰ï¼Œå¯ä»¥è®¾ç½®ï¼š

- **æ„å»ºå‘½ä»¤**: `npm install`ï¼ˆå¦‚æœéœ€è¦å®‰è£…ä¾èµ–ï¼‰
- **éƒ¨ç½²å‘½ä»¤**: `npx wrangler deploy`ï¼ˆä¿æŒä¸å˜ï¼‰

**æ³¨æ„**: å¦‚æœ `bettafish-workers/package.json` ä¸­æ²¡æœ‰ `build` è„šæœ¬ï¼Œæ„å»ºå‘½ä»¤å¯ä»¥ç•™ç©ºæˆ–åªè®¾ç½® `npm install`ã€‚

### Step 3: éªŒè¯é…ç½®

ä¿®æ”¹åï¼Œé…ç½®åº”è¯¥æ˜¯ï¼š
- **æ ¹ç›®å½•**: `bettafish-workers` âœ…
- **æ„å»ºå‘½ä»¤**: `npm install` æˆ–ç•™ç©º
- **éƒ¨ç½²å‘½ä»¤**: `npx wrangler deploy` âœ…
- **åˆ†æ”¯è·Ÿè¸ª**: `main` âœ…

### Step 4: æµ‹è¯•è‡ªåŠ¨æ„å»º

1. **æ¨é€ä¸€ä¸ªæµ‹è¯•æ›´æ”¹**:
   ```bash
   # åœ¨ bettafish-workers ç›®å½•ä¸‹åšä¸€ä¸ªå°æ”¹åŠ¨
   cd bettafish-workers
   echo "# Test" >> README.md
   git add README.md
   git commit -m "Test: Trigger Workers auto build"
   git push origin main
   ```

2. **æ£€æŸ¥ Cloudflare Dashboard**:
   - è¿›å…¥ Workers è¯¦æƒ…é¡µ
   - ç‚¹å‡» **Deployments** æ ‡ç­¾
   - åº”è¯¥çœ‹åˆ°æ–°çš„éƒ¨ç½²æ­£åœ¨æ„å»ºï¼ˆé€šå¸¸åœ¨æ¨é€å 1-2 åˆ†é’Ÿå†…ï¼‰

3. **æŸ¥çœ‹æ„å»ºæ—¥å¿—**:
   - å¦‚æœæ„å»ºå¤±è´¥ï¼Œç‚¹å‡»éƒ¨ç½²æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
   - æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

## ğŸ“‹ å®Œæ•´çš„ Workers é…ç½®æ£€æŸ¥æ¸…å•

### Git é›†æˆè®¾ç½®
- [ ] Repository: `keithhegit/public_opinion`
- [ ] åˆ†æ”¯è·Ÿè¸ª: `main`
- [ ] æ ¹ç›®å½•: `bettafish-workers` âš ï¸ **éœ€è¦ä¿®æ”¹**
- [ ] æ‹‰å–è¯·æ±‚é¢„è§ˆ: å·²å¯ç”¨

### æ„å»ºé…ç½®
- [ ] æ„å»ºå‘½ä»¤: `npm install` æˆ–ç•™ç©º
- [ ] éƒ¨ç½²å‘½ä»¤: `npx wrangler deploy`
- [ ] ç‰ˆæœ¬å‘½ä»¤: `npx wrangler versions upload`ï¼ˆå¯é€‰ï¼‰

### æ„å»ºç›‘è§†è·¯å¾„
- [ ] åŒ…æ‹¬è·¯å¾„: `bettafish-workers/**` æˆ– `*`

## ğŸ” éªŒè¯ Workers è‡ªåŠ¨æ„å»º

### æ–¹æ³• 1: æŸ¥çœ‹éƒ¨ç½²å†å²

1. åœ¨ Cloudflare Dashboard ä¸­
2. è¿›å…¥ Workers â†’ **Deployments**
3. æŸ¥çœ‹æœ€æ–°éƒ¨ç½²ï¼š
   - **æ¥æº**: åº”è¯¥æ˜¾ç¤º "Git Integration"
   - **åˆ†æ”¯**: åº”è¯¥æ˜¾ç¤º `main`
   - **æ—¶é—´**: åº”è¯¥æ˜¯æœ€æ–°çš„æ¨é€æ—¶é—´

### æ–¹æ³• 2: æµ‹è¯• API

```bash
# æµ‹è¯• Workers API
curl https://bettafish-api-prod.keithhe2021.workers.dev/api/health

# åº”è¯¥è¿”å› JSON å“åº”
```

### æ–¹æ³• 3: æŸ¥çœ‹æ„å»ºæ—¥å¿—

å¦‚æœæ„å»ºå¤±è´¥ï¼š
1. ç‚¹å‡»å¤±è´¥çš„éƒ¨ç½²
2. æŸ¥çœ‹æ„å»ºæ—¥å¿—
3. æ£€æŸ¥é”™è¯¯ä¿¡æ¯

## ğŸš¨ å¸¸è§é—®é¢˜

### é—®é¢˜ 1: ä¿®æ”¹æ ¹ç›®å½•åä»ç„¶ä¸æ„å»º

**å¯èƒ½åŸå› **:
- Git é›†æˆéœ€è¦é‡æ–°è¿æ¥
- API ä»¤ç‰Œè¿‡æœŸ

**è§£å†³**:
1. æ–­å¼€ Git è¿æ¥
2. é‡æ–°è¿æ¥ Git å­˜å‚¨åº“
3. ç¡®ä¿é€‰æ‹©æ­£ç¡®çš„åˆ†æ”¯å’Œæ ¹ç›®å½•

### é—®é¢˜ 2: æ„å»ºå‘½ä»¤å¤±è´¥

**ç—‡çŠ¶**: éƒ¨ç½²çŠ¶æ€æ˜¾ç¤º "Failed"

**æ’æŸ¥**:
- æ£€æŸ¥ `bettafish-workers/package.json` æ˜¯å¦æœ‰ `build` è„šæœ¬
- æ£€æŸ¥ `wrangler.toml` æ˜¯å¦å­˜åœ¨ä¸”é…ç½®æ­£ç¡®
- æŸ¥çœ‹æ„å»ºæ—¥å¿—ä¸­çš„å…·ä½“é”™è¯¯

**è§£å†³**:
- å¦‚æœä¸éœ€è¦æ„å»ºï¼Œå°†æ„å»ºå‘½ä»¤ç•™ç©º
- å¦‚æœéœ€è¦æ„å»ºï¼Œç¡®ä¿ `package.json` ä¸­æœ‰æ­£ç¡®çš„è„šæœ¬

### é—®é¢˜ 3: æ‰¾ä¸åˆ° wrangler.toml

**ç—‡çŠ¶**: æ„å»ºæ—¥å¿—æ˜¾ç¤º "wrangler.toml not found"

**è§£å†³**:
- ç¡®ä¿æ ¹ç›®å½•è®¾ç½®ä¸º `bettafish-workers`
- ç¡®ä¿ `bettafish-workers/wrangler.toml` æ–‡ä»¶å­˜åœ¨

## ğŸ“ å½“å‰ Workers æ–‡ä»¶ç»“æ„

```
bettafish-workers/
â”œâ”€â”€ wrangler.toml          # Workers é…ç½®æ–‡ä»¶
â”œâ”€â”€ package.json           # ä¾èµ–å’Œè„šæœ¬
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts          # ä¸»å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ routes/           # è·¯ç”±æ–‡ä»¶
â”‚       â”œâ”€â”€ tasks.ts      # ä»»åŠ¡ç®¡ç†è·¯ç”±ï¼ˆæ–°æ·»åŠ ï¼‰
â”‚       â””â”€â”€ ...
â””â”€â”€ ...
```

## âœ… å®Œæˆåçš„çŠ¶æ€

ä¿®æ”¹æ ¹ç›®å½•åï¼ŒWorkers åº”è¯¥ï¼š
- âœ… è‡ªåŠ¨ä» `main` åˆ†æ”¯æ£€æµ‹æ›´æ”¹
- âœ… åœ¨ `bettafish-workers/` ç›®å½•ä¸‹æŸ¥æ‰¾æ–‡ä»¶
- âœ… è‡ªåŠ¨æ‰§è¡Œéƒ¨ç½²å‘½ä»¤
- âœ… æˆåŠŸéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **ä¿®æ”¹æ ¹ç›®å½•**ä¸º `bettafish-workers`
2. **æ¨é€æµ‹è¯•æ›´æ”¹**éªŒè¯è‡ªåŠ¨æ„å»º
3. **æ£€æŸ¥éƒ¨ç½²çŠ¶æ€**ç¡®è®¤æ„å»ºæˆåŠŸ
4. **æµ‹è¯• API**ç¡®è®¤åŠŸèƒ½æ­£å¸¸

