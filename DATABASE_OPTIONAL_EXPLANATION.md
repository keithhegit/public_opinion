# æ•°æ®åº“åŠŸèƒ½å¯é€‰æ€§è¯´æ˜

## ğŸ“‹ ç»“è®º

**æ•°æ®åº“åŠŸèƒ½æ˜¯å¯é€‰çš„ï¼Œä¸æ˜¯ä¸»æµç¨‹ä¸­å¿…é¡»çš„ã€‚**

---

## ğŸ” è¯¦ç»†åˆ†æ

### 1. æ•°æ®åº“å·¥å…·çš„ä½¿ç”¨æ–¹å¼

#### Insight Engineä¸­çš„æ•°æ®åº“å·¥å…·
- **å·¥å…·ç±»**: `MediaCrawlerDB` (ä½äº `InsightEngine/tools/search.py`)
- **åˆå§‹åŒ–**: åœ¨ `DeepSearchAgent.__init__()` ä¸­åˆ›å»ºå®ä¾‹ï¼ˆç¬¬45è¡Œï¼‰
- **åˆå§‹åŒ–è¡Œä¸º**: `MediaCrawlerDB.__init__()` åªæ˜¯ `pass`ï¼Œ**ä¸ä¼šç«‹å³è¿æ¥æ•°æ®åº“**

```python
# InsightEngine/agent.py:45
self.search_agency = MediaCrawlerDB()  # ä¸ä¼šè¿æ¥æ•°æ®åº“
```

### 2. æ•°æ®åº“æŸ¥è¯¢çš„æ‰§è¡Œæ—¶æœº

æ•°æ®åº“æŸ¥è¯¢åªåœ¨ä»¥ä¸‹æƒ…å†µæ‰§è¡Œï¼š
1. **LLMè°ƒç”¨å·¥å…·æ—¶**: LLMé€šè¿‡tool callingæœºåˆ¶å†³å®šæ˜¯å¦è°ƒç”¨æ•°æ®åº“å·¥å…·
2. **Agentæ‰§è¡Œå·¥å…·æ—¶**: åœ¨ `execute_search_tool()` æ–¹æ³•ä¸­å®é™…æ‰§è¡ŒæŸ¥è¯¢

```python
# InsightEngine/agent.py:181
response = self.search_agency.search_topic_globally(topic=keyword, ...)
# æ­¤æ—¶æ‰ä¼šæ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢
```

### 3. ç©ºç»“æœçš„å¤„ç†æœºåˆ¶

#### æ•°æ®åº“æŸ¥è¯¢å¤±è´¥æ—¶çš„å¤„ç†
- **ä½ç½®**: `InsightEngine/tools/search.py:_execute_query()` (ç¬¬78-95è¡Œ)
- **è¡Œä¸º**: æ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œè¿”å›ç©ºåˆ—è¡¨ `[]`
- **å½±å“**: Engineç»§ç»­æ‰§è¡Œï¼Œä¸ä¼šå¡ä½

```python
def _execute_query(self, query: str, params: tuple = None) -> List[Dict[str, Any]]:
    try:
        # ... æ‰§è¡ŒæŸ¥è¯¢ ...
        return loop.run_until_complete(fetch_all(query, params))
    except Exception as e:
        logger.exception(f"æ•°æ®åº“æŸ¥è¯¢æ—¶å‘ç”Ÿé”™è¯¯: {e}")
        return []  # è¿”å›ç©ºåˆ—è¡¨ï¼Œä¸æŠ›å‡ºå¼‚å¸¸
```

#### Agentå¯¹ç©ºç»“æœçš„å¤„ç†
- **ä½ç½®**: `InsightEngine/agent.py:execute_search_tool()` (ç¬¬210-215è¡Œ)
- **è¡Œä¸º**: å¦‚æœ `response.results` ä¸ºç©ºï¼Œè®°å½•æ—¥å¿—ä½†ç»§ç»­æ‰§è¡Œ
- **æœ€ç»ˆç»“æœ**: è¿”å› `DBResponse`ï¼Œå…¶ä¸­ `results=[]`ï¼Œ`results_count=0`

```python
# æ”¶é›†ç»“æœ
if response.results:
    logger.info(f"     æ‰¾åˆ° {len(response.results)} æ¡ç»“æœ")
    all_results.extend(response.results)
else:
    logger.info(f"     æœªæ‰¾åˆ°ç»“æœ")  # ç»§ç»­æ‰§è¡Œï¼Œä¸æŠ¥é”™
```

### 4. LLMå¦‚ä½•å¤„ç†ç©ºç»“æœ

- **LLMä¼šæ”¶åˆ°**: `DBResponse` å¯¹è±¡ï¼Œå…¶ä¸­ `results=[]`
- **LLMè¡Œä¸º**: çŸ¥é“æ²¡æœ‰æ‰¾åˆ°æ•°æ®åº“ç»“æœï¼Œä½†ä¸ä¼šå¯¼è‡´Engineå¤±è´¥
- **Engineç»§ç»­**: ç»§ç»­æ‰§è¡Œåç»­æ­¥éª¤ï¼ˆå¦‚åæ€ã€æ€»ç»“ç­‰ï¼‰

---

## âœ… ä¿®å¤åçš„è¡Œä¸º

### å¦‚æœæ•°æ®åº“ä¸å¯ç”¨ï¼ˆDB_HOSTæœªé…ç½®æˆ–ä¸ºyour_db_hostï¼‰

1. **åˆå§‹åŒ–é˜¶æ®µ**:
   - âœ… `MediaCrawlerDB()` æ­£å¸¸åˆå§‹åŒ–ï¼ˆä¸ä¼šè¿æ¥æ•°æ®åº“ï¼‰
   - âœ… `get_async_engine()` è¿”å› `None`ï¼ˆæ£€æµ‹åˆ°æ— æ•ˆé…ç½®ï¼‰
   - âœ… è®°å½•è­¦å‘Šæ—¥å¿—ï¼š"æ•°æ®åº“é…ç½®æ— æ•ˆ: DB_HOST æœªè®¾ç½®æˆ–ä¸ºé»˜è®¤å€¼ 'your_db_host'ï¼Œè·³è¿‡æ•°æ®åº“è¿æ¥"

2. **æŸ¥è¯¢é˜¶æ®µ**:
   - âœ… `fetch_all()` æ£€æµ‹åˆ° `engine is None`ï¼Œè¿”å›ç©ºåˆ—è¡¨
   - âœ… `_execute_query()` æ•è·å¼‚å¸¸ï¼Œè¿”å›ç©ºåˆ—è¡¨
   - âœ… `execute_search_tool()` æ”¶åˆ°ç©ºç»“æœï¼Œè®°å½•"æœªæ‰¾åˆ°ç»“æœ"ä½†ç»§ç»­æ‰§è¡Œ

3. **Engineæ‰§è¡Œ**:
   - âœ… Engineç»§ç»­æ‰§è¡Œï¼Œä¸ä¼šå¡ä½
   - âœ… LLMçŸ¥é“æ²¡æœ‰æ•°æ®åº“ç»“æœï¼Œä¼šåŸºäºå…¶ä»–ä¿¡æ¯ï¼ˆå¦‚ç½‘ç»œæœç´¢ï¼‰ç»§ç»­åˆ†æ
   - âœ… æœ€ç»ˆæŠ¥å‘Šå¯èƒ½ä¸åŒ…å«æ•°æ®åº“æŸ¥è¯¢ç»“æœï¼Œä½†Engineèƒ½æ­£å¸¸å®Œæˆ

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: ä¸ä½¿ç”¨æ•°æ®åº“ï¼ˆå½“å‰æƒ…å†µï¼‰
- **é…ç½®**: ä¸è®¾ç½® `DB_HOST` æˆ–è®¾ç½®ä¸º `your_db_host`
- **è¡Œä¸º**: Engineè·³è¿‡æ•°æ®åº“æŸ¥è¯¢ï¼Œåªä½¿ç”¨ç½‘ç»œæœç´¢ï¼ˆå¦‚Tavilyã€Bochaç­‰ï¼‰
- **ç»“æœ**: Engineæ­£å¸¸å·¥ä½œï¼ŒæŠ¥å‘ŠåŸºäºç½‘ç»œæœç´¢ç»“æœ

### åœºæ™¯2: ä½¿ç”¨æ•°æ®åº“
- **é…ç½®**: æ­£ç¡®è®¾ç½® `DB_HOST`ã€`DB_USER`ã€`DB_PASSWORD`ã€`DB_NAME` ç­‰
- **è¡Œä¸º**: Engineå¯ä»¥ä½¿ç”¨æ•°æ®åº“æŸ¥è¯¢å·¥å…·ï¼Œè·å–æœ¬åœ°å­˜å‚¨çš„èˆ†æƒ…æ•°æ®
- **ç»“æœ**: Engineå¯ä»¥ä½¿ç”¨æ•°æ®åº“ç»“æœ + ç½‘ç»œæœç´¢ç»“æœï¼Œæä¾›æ›´å…¨é¢çš„åˆ†æ

---

## ğŸ“ ä»£ç éªŒè¯

### éªŒè¯ç‚¹1: åˆå§‹åŒ–ä¸ä¼šè¿æ¥æ•°æ®åº“
```python
# InsightEngine/tools/search.py:72-76
def __init__(self):
    """
    åˆå§‹åŒ–å®¢æˆ·ç«¯ã€‚
    """
    pass  # ä¸ä¼šè¿æ¥æ•°æ®åº“
```

### éªŒè¯ç‚¹2: æŸ¥è¯¢å¤±è´¥è¿”å›ç©ºåˆ—è¡¨
```python
# InsightEngine/tools/search.py:78-95
def _execute_query(self, query: str, params: tuple = None) -> List[Dict[str, Any]]:
    try:
        # ... æ‰§è¡ŒæŸ¥è¯¢ ...
        return loop.run_until_complete(fetch_all(query, params))
    except Exception as e:
        logger.exception(f"æ•°æ®åº“æŸ¥è¯¢æ—¶å‘ç”Ÿé”™è¯¯: {e}")
        return []  # è¿”å›ç©ºåˆ—è¡¨
```

### éªŒè¯ç‚¹3: Agentå¤„ç†ç©ºç»“æœ
```python
# InsightEngine/agent.py:210-215
if response.results:
    logger.info(f"     æ‰¾åˆ° {len(response.results)} æ¡ç»“æœ")
    all_results.extend(response.results)
else:
    logger.info(f"     æœªæ‰¾åˆ°ç»“æœ")  # ç»§ç»­æ‰§è¡Œ
```

---

## âœ… æ€»ç»“

1. **æ•°æ®åº“åŠŸèƒ½æ˜¯å¯é€‰çš„** - ä¸æ˜¯ä¸»æµç¨‹ä¸­å¿…é¡»çš„
2. **Engineå¯ä»¥åœ¨æ²¡æœ‰æ•°æ®åº“çš„æƒ…å†µä¸‹æ­£å¸¸å·¥ä½œ** - åªä½¿ç”¨ç½‘ç»œæœç´¢
3. **ä¿®å¤æ˜¯æ­£ç¡®çš„** - å¦‚æœæ•°æ®åº“ä¸å¯ç”¨ï¼Œè¿”å›ç©ºåˆ—è¡¨è€Œä¸æ˜¯å¡ä½
4. **å½“å‰é…ç½®ï¼ˆä¸ä½¿ç”¨æ•°æ®åº“ï¼‰å®Œå…¨å¯è¡Œ** - Engineä¼šè·³è¿‡æ•°æ®åº“æŸ¥è¯¢ï¼Œç»§ç»­æ‰§è¡Œ

---

**æœ€åæ›´æ–°**: 2025-11-11
**çŠ¶æ€**: âœ… æ•°æ®åº“åŠŸèƒ½å·²ç¡®è®¤ä¸ºå¯é€‰

